;/*FB_PKG_DELIM*/

__d("LSShimThreadPinMessage.nop",["FBLogger","I64","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h,i;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g,j){if(j==null){c("FBLogger")("messenger_web_pinned_messages").warn("threadKey is null in LSShimThreadPinMessage");return}e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.client_web_pinned_messages).getKeyRange(j,f)));yield (i||(i=b("Promise"))).all(e.map(function(b){return a.client_web_pinned_messages["delete"](b.threadKey,b.offlineThreadingId,b.pinnedTimestampMs)}));yield a.client_web_pinned_messages.put({offlineThreadingId:f,pinnedTimestampMs:g||(h||(h=d("I64"))).of_float(Date.now()),threadKey:j})});function e(b,c,d,e,f){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("LSShimThreadUnpinMessage.nop",["FBLogger","Promise","ReQL","asyncToGeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e,f,g){if(g==null){c("FBLogger")("messenger_web_pinned_messages").warn("threadKey is null in LSShimThreadUnpinMessage");return}e=(yield d("ReQL").toArrayAsync(d("ReQL").fromTableDescending(a.client_web_pinned_messages).getKeyRange(g,f)));yield (h||(h=b("Promise"))).all(e.map(function(b){return a.client_web_pinned_messages["delete"](b.threadKey,b.offlineThreadingId,b.pinnedTimestampMs)}))});function e(b,c,d,e){return a.apply(this,arguments)}return e}();g["default"]=a}),98);
__d("LSOptimisticSetOrUnsetPinnedMessage",["LSIssueNewTask","LSShimThreadPinMessage.nop","LSShimThreadUnpinMessage.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[],e=[];return c.sequence([function(e){return c.i64.neq(a[1],void 0)?c.i64.eq(a[3],c.i64.cast([0,1]))||c.i64.eq(a[3],c.i64.cast([0,2]))?c.sequence([function(d){return c.nativeOperation(b("LSShimThreadPinMessage.nop"),a[0],a[2],a[1])},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,1]):(b=a.item,d[6]=b.syncGroup,c.i64.neq(d[6],void 0)?d[5]=d[6]:d[5]=c.i64.cast([0,1]),d[0]=d[5])})},function(e){return d[2]=new c.Map(),d[2].set("armadillo_thread_key",a[1]),d[2].set("offline_threading_id",a[0]),d[2].set("timestamp_ms",a[2]),d[2].set("sync_group",d[0]),d[3]=d[2].get("timestamp_ms"),d[2],d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),["e2ee_pin_msg","_",c.i64.to_string(d[3])].join(""),c.i64.cast([0,1010]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.sequence([function(d){return c.nativeOperation(b("LSShimThreadUnpinMessage.nop"),a[0],a[1])},function(b){return c.db.table(9).fetch([[[a[1]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?d[0]=c.i64.cast([0,1]):(b=a.item,d[6]=b.syncGroup,c.i64.neq(d[6],void 0)?d[5]=d[6]:d[5]=c.i64.cast([0,1]),d[0]=d[5])})},function(e){return d[2]=new c.Map(),d[2].set("armadillo_thread_key",a[1]),d[2].set("offline_threading_id",a[0]),d[2].set("timestamp_ms",a[2]),d[2].set("sync_group",d[0]),d[3]=d[2].get("timestamp_ms"),d[2],d[4]=c.toJSON(d[2]),c.storedProcedure(b("LSIssueNewTask"),["e2ee_unpin_msg","_",c.i64.to_string(d[3])].join(""),c.i64.cast([0,1011]),d[4],void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]),void 0,void 0,c.i64.cast([0,0]),c.i64.cast([0,0]))}]):c.resolve()},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSOptimisticSetOrUnsetPinnedMessageStoredProcedure",["LSOptimisticSetOrUnsetPinnedMessage","cr:8709"],(function(a,b,c,d,e,f,g){function a(a,b){var d=[];d[0]=b.offlineThreadingId;d[1]=b.threadKey;d[2]=b.timestampMs;d[3]=b.state;return c("LSOptimisticSetOrUnsetPinnedMessage").apply(void 0,d.concat([a]))}g["default"]=a}),98);
__d("LSSetOrUnsetPinnedMessage",["LSShimThreadPinMessage.nop","LSShimThreadUnpinMessage.nop"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1],d=[];return c.sequence([function(d){return c.i64.eq(a[2],c.i64.cast([0,1]))||c.i64.eq(a[2],c.i64.cast([0,2]))?c.nativeOperation(b("LSShimThreadPinMessage.nop"),a[0],a[1],a[3]):c.nativeOperation(b("LSShimThreadUnpinMessage.nop"),a[0],a[3])},function(a){return c.resolve(d)}])}e.exports=a}),null);
__d("useMAWToggleSecurePinMessage",["I64","LSFactory","LSOptimisticSetOrUnsetPinnedMessageStoredProcedure","LSPinnedMessageState","MWPBumpEntityKey","MessengerWebUXLogger","ReQL","ServerTime","asyncToGeneratorRuntime","react","useAsyncReStore","useMWPIsMessagePinned"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(h||d("react")).useCallback;function a(a,e){var g=c("useAsyncReStore")(),h=c("useMWPIsMessagePinned")(a),k=a.offlineThreadingId,l=a.threadKey,m=d("ServerTime").getMillis(),n=c("MessengerWebUXLogger").useInteractionLogger();a=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(){var a=(yield g),b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads,["threadType"]).getKeyRange(l)));yield a.runInTransaction(function(a){var f=h?c("LSPinnedMessageState").NOT_PINNED:c("LSPinnedMessageState").PINNED,g=h?"unpin_message":"pin_message",j=h?"unpin":"pin";e==="message_dot_menu"?n==null?void 0:n({eventName:g,threadKey:l,threadType:b==null?void 0:b.threadType}):j==="unpin"&&e==="pinned_message_list_dot_menu"&&d("MWPBumpEntityKey").bumpEntityKeyWithAppId("mw_pinned_messages","unpin");return c("LSOptimisticSetOrUnsetPinnedMessageStoredProcedure")(c("LSFactory")(a),{offlineThreadingId:k,state:(i||(i=d("I64"))).of_int32(f),threadKey:l,timestampMs:i.of_int32(m)})},"readwrite",void 0,void 0,f.id+":51")});return function(){return a.apply(this,arguments)}}();return j(a,[g,h,l,m,k,e,n])}g["default"]=a}),98);