;/*FB_PKG_DELIM*/

__d("MessageRangeSet",["I64","ReplayLastSubject","err"],(function(a,b,c,d,e,f,g){"use strict";var h,i=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;c.value=a;return c}var c=a.prototype;c.next=function(a){this.value=a,b.prototype.next.call(this,a)};return a}(d("ReplayLastSubject").ReplayLastSubject),j=function(b){babelHelpers.inheritsLoose(a,b);function a(a){var c;c=b.call(this,a)||this;for(var d=arguments.length,e=new Array(d>1?d-1:0),f=1;f<d;f++)e[f-1]=arguments[f];e.forEach(function(a){c.subscribe({complete:function(){return a.complete()},error:function(b){return a.error(b)},next:function(b){return a.next(b)}})});c.next(a);return c}return a}(i);a=function(){function a(){this.$1=new Set()}var b=a.prototype;b.$2=function(a){for(var b=this.$1,c=Array.isArray(b),e=0,b=c?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f;if(c){if(e>=b.length)break;f=b[e++]}else{e=b.next();if(e.done)break;f=e.value}f=f;var g=f.value;if((h||(h=d("I64"))).le(g.minTimestampMs,a)&&((h||(h=d("I64"))).ge(g.maxTimestampMs,a)||!g.hasMoreAfter))return f}return null};b.getRangeForTimestamp=function(a){return this.$2(a)};b.upsertRange=function(a){var b=Array.from(this.$1.values()).filter(function(b){return l(b.value,a)});if(b.length===0){var c=new i(a);this.$1.add(c);return c}c=k.apply(void 0,b.map(function(a){return a.value}).concat([a]));if(b.length===1){var d=b[0];d.next(c);return d}for(var d=b,e=Array.isArray(d),f=0,d=e?d:d[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var g;if(e){if(f>=d.length)break;g=d[f++]}else{f=d.next();if(f.done)break;g=f.value}g=g;this.$1["delete"](g)}g=babelHelpers.construct(j,[c].concat(b));this.$1.add(g);return g};return a}();function k(){for(var a=arguments.length,b=new Array(a),e=0;e<a;e++)b[e]=arguments[e];if(b.length===0)throw c("err")("Cannot merge 0 ranges");var f=b[0].threadKey,g=b[0].minTimestampMs,i=b[0].hasMoreAfter,j=b[0].hasMoreBefore,k=b[0].maxMessageId,l=b[0].minMessageId,m=b[0].maxTimestampMs;for(var n=1;n<b.length;n++){var o=b[n];(h||(h=d("I64"))).le(o.minTimestampMs,g)&&((h||(h=d("I64"))).equal(o.minTimestampMs,g)?j=j&&o.hasMoreBefore:j=o.hasMoreBefore,g=o.minTimestampMs,l=o.minMessageId);(h||(h=d("I64"))).ge(o.maxTimestampMs,m)&&((h||(h=d("I64"))).equal(o.maxTimestampMs,m)?i=i&&o.hasMoreAfter:i=o.hasMoreAfter,m=o.maxTimestampMs,k=o.maxMessageId)}return{hasMoreAfter:i,hasMoreBefore:j,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:k,maxTimestampMs:m,minMessageId:l,minTimestampMs:g,threadKey:f}}function l(a,b){var c=(h||(h=d("I64"))).le(b.minTimestampMs,a.minTimestampMs),e=c?b:a;c=c?a:b;return m(e,c.minTimestampMs)?!0:!1}function m(a,b){return(h||(h=d("I64"))).ge(b,a.minTimestampMs)&&(h||(h=d("I64"))).le(b,a.maxTimestampMs)}g["default"]=a}),98);
__d("findMsgsWithMinAndMaxTimestamp",[],(function(a,b,c,d,e,f){"use strict";function a(a){a=a.filter(function(a){return a.sortOrderMs!=null});var b=null,c=null;for(var a=a,d=Array.isArray(a),e=0,a=d?a:a[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var f,g;if(d){if(e>=a.length)break;g=a[e++]}else{e=a.next();if(e.done)break;g=e.value}g=g;if(g.sortOrderMs==null)continue;(((f=b)==null?void 0:f.sortOrderMs)==null||b.sortOrderMs<g.sortOrderMs)&&(b=g);(((f=c)==null?void 0:f.sortOrderMs)==null||c.sortOrderMs>g.sortOrderMs)&&(c=g)}return[c,b]}f["default"]=a}),66);
__d("switchMap",["relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(a,b){return d("relay-runtime").Observable.create(function(c){var d,e=a.subscribe({complete:c.complete,error:c.error,next:function(a){var e;(e=d)==null?void 0:e.unsubscribe();d=b(a).subscribe(c)}});return function(){var a;(a=d)==null?void 0:a.unsubscribe();e.unsubscribe()}})}g["default"]=a}),98);
__d("EBMessageRangeDataSource",["I64","LSAuthorityLevel","LSDatabaseSingleton","LSIntEnum","MAWEBFetch","MAWMiActOnActThreadReady","MAWPutMessagesToDB","MAWSecureLocalDBFetch","MAWTraceUtils","MLV2DataSourceLogger","MessageRangeSet","Promise","ReQL","ReQLObservable","ReplayLastSubject","WAResultOrError","WATagsLogger","asyncToGeneratorRuntime","findMsgsWithMinAndMaxTimestamp","nullthrows","recoverableViolation","relay-runtime","switchMap"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k;function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["EBMessageRangeDataSource: Failed to fetch messages from EB. Message: "," TraceId: "," Request: ",""]);l=function(){return a};return a}var m=function(a){var e=this;this.$2=new(c("MessageRangeSet"))();this.getOrCreateMessageRangeCoveringCursor=function(a,b){var c=e.$2.getRangeForTimestamp(a.timestampMs);b==null?void 0:b.annotateMessageRangesDataSource("EBMessageRangeDataSource");if(c!=null)return c;b=(k||(k=d("I64"))).equal(a.timestampMs,k.max_int);c={hasMoreAfter:!b,hasMoreBefore:!0,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:(c=a.messageId)!=null?c:"",maxTimestampMs:a.timestampMs,minMessageId:(b=a.messageId)!=null?b:"",minTimestampMs:a.timestampMs,threadKey:e.$1};b=e.$2.upsertRange(c);return b};this.extendRange=function(a,f){var g=d("MLV2DataSourceLogger").getMLV2LoggerForThread(e.$1,f);a=e.$2.getRangeForTimestamp(a.minTimestampMs);if(a==null){c("recoverableViolation")("EBDataSource: Requested to extend a nonexisting range","maw_message_core");g==null?void 0:g.markQPLPoint("extend_range_invalid");return(h||(h=b("Promise"))).resolve()}var i=a.value;if(f==="asc"&&(!i.hasMoreAfter||i.isLoadingAfter)){g==null?void 0:g.markQPLPoint("extend_range_skipped");return(h||(h=b("Promise"))).resolve()}if(f==="desc"&&(!i.hasMoreBefore||i.isLoadingBefore)){g==null?void 0:g.markQPLPoint("extend_range_skipped");return(h||(h=b("Promise"))).resolve()}a.next(babelHelpers["extends"]({},i,{isLoadingAfter:i.isLoadingAfter||f==="asc",isLoadingBefore:i.isLoadingBefore||f==="desc"}));return e.$3(a.value,f)};this.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,f){var g=d("MLV2DataSourceLogger").getMLV2LoggerForThread(e.$1,f),j=(yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton);g==null?void 0:g.markQPLPoint("eb_wait_act_thread_start");var m=(yield d("MAWMiActOnActThreadReady").waitForACTThreadReady(j.tables,e.$1,"MAWMessageRangeDataSourceForThread"));m=m.chatJid;g==null?void 0:g.markQPLPoint("eb_wait_act_thread_end");g==null?void 0:g.markQPLPoint("wait_eb_fetch_start");var n=f==="asc"?a.maxTimestampMs:a.minTimestampMs,p=m+":"+(k||(k=d("I64"))).to_string(n)+":"+f+":20",q=d("MAWTraceUtils").createTraceId();j=(yield (h||(h=b("Promise"))).race([c("MAWEBFetch")({chatJid:m,count:20,db:j,direction:o(f),timestampMs:n,traceId:q}),new h(function(a){return window.setTimeout(function(){return a(d("WAResultOrError").makeError("timeout"))},1e4)})]));var r=function(){return{hasMoreAfter:!1,hasMoreBefore:!1,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:"",maxTimestampMs:(k||(k=d("I64"))).max_int,minMessageId:"",minTimestampMs:k.min_int,threadKey:e.$1}};if(j.success===!1){d("WATagsLogger").TAGS(["maw_message_core","EBMessageRangeDataSource",q]).ERROR(l(),j.error,q,p);g==null?void 0:g.markQPLPoint("eb_fetch_response_fail");g==null?void 0:g.addQPLAnnotations({string:{eb_failure_reason:j.error}});e.$2.upsertRange(r());return}var s=j.value.hasMoreAfter,t=j.value.hasMoreBefore;q=f==="asc"?j.value.messages.filter(function(b){return b.sortOrderMs!=null&&(k||(k=d("I64"))).ge((k||(k=d("I64"))).of_float(b.sortOrderMs),a.maxTimestampMs)}):j.value.messages.filter(function(b){return b.sortOrderMs!=null&&(k||(k=d("I64"))).le((k||(k=d("I64"))).of_float(b.sortOrderMs),a.minTimestampMs)});q.length!==j.value.messages.length&&c("recoverableViolation")("EBMessageRangeDataSource: EB fetch API returned invalid messages outside requested timerange","messenger_web_product");q.length===0&&(f==="asc"&&s&&(s=!1,c("recoverableViolation")("EBMessageRangeDataSource: Unexpected null messages after","messenger_web_product")),f==="desc"&&t&&(t=!1,c("recoverableViolation")("EBMessageRangeDataSource: Unexpected null messages before","messenger_web_product")));g==null?void 0:g.markQPLPoint("wait_eb_fetch_end");g==null?void 0:g.markQPLPoint("wait_secure_local_db_fetch_start");p=(yield c("MAWSecureLocalDBFetch")({actionType:"user",chatJid:m,config:{editMsgHistory:!0,media:!0,reactions:!0,xma:!0},count:20,direction:o(f),offsetMsg:{includeOriginalMsg:!1,messageId:f==="asc"?a.maxMessageId:a.minMessageId},timestampMs:f==="asc"?a.maxTimestampMs:a.minTimestampMs}));g==null?void 0:g.markQPLPoint("insert_msgs_to_lsdb_start","begin inserting the messages into LSDB");yield d("MAWPutMessagesToDB").insertMessageResponseIntoDatabase(yield i.LSDatabaseSingleton,p);g==null?void 0:g.markQPLPoint("insert_msgs_to_lsdb_end");g==null?void 0:g.markQPLPoint("maw_upsert_range_start");j=q.map(function(a){return a.sortOrderMs}).filter(Boolean);m=[Math.min.apply(Math,j),Math.max.apply(Math,j)];q=m[0];j=m[1];var u=f==="desc"?[(k||(k=d("I64"))).of_float(q),n]:[n,(k||(k=d("I64"))).of_float(j)];m=p.msgs.filter(function(a){return(k||(k=d("I64"))).ge((k||(k=d("I64"))).of_float(a.sortOrderMs),u[0])&&(k||(k=d("I64"))).le((k||(k=d("I64"))).of_float(a.sortOrderMs),u[1])});if(m.length===0){c("recoverableViolation")("EBMessageRangeDataSource: No local messages found within EB response range","messenger_web_product");g==null?void 0:g.markQPLPoint("eb_fetch_has_no_local_msg_overlap");e.$2.upsertRange(r());return}q=c("findMsgsWithMinAndMaxTimestamp")(m);var v=q[0],w=q[1];n=babelHelpers["extends"]({},a,function(){var b;switch(f){case"asc":return{hasMoreAfter:s,isLoadingAfter:!1,maxMessageId:(b=w==null?void 0:w.msgId)!=null?b:a.maxMessageId,maxTimestampMs:(k||(k=d("I64"))).max(a.maxTimestampMs,(w==null?void 0:w.sortOrderMs)!=null?(k||(k=d("I64"))).of_float(w==null?void 0:w.sortOrderMs):a.maxTimestampMs)};case"desc":return{hasMoreBefore:t,isLoadingBefore:!1,minMessageId:(b=v==null?void 0:v.msgId)!=null?b:a.minMessageId,minTimestampMs:(k||(k=d("I64"))).min(a.minTimestampMs,(v==null?void 0:v.sortOrderMs)!=null?(k||(k=d("I64"))).of_float(v==null?void 0:v.sortOrderMs):a.minTimestampMs)}}}());e.$2.upsertRange(n);g==null?void 0:g.markQPLPoint("maw_upsert_range_end")});return function(b,c){return a.apply(this,arguments)}}();this.$1=a},n=function(){function a(a){var e=this;this.$1=new Map();this.$3=!1;this.getOrCreateMessageRangeCoveringCursor=function(a,b){var f=a.threadKey;return c("switchMap")(e.$2,function(c){return!c?d("relay-runtime").Observable.from(new(d("ReplayLastSubject").ReplayLastSubject)({hasMoreAfter:!1,hasMoreBefore:!1,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:"",maxTimestampMs:(k||(k=d("I64"))).max_int,minMessageId:"",minTimestampMs:k.min_int,threadKey:f})):d("relay-runtime").Observable.from(e.$4(f).getOrCreateMessageRangeCoveringCursor(a,b))})};this.extendRange=function(a,c){var f=a.threadKey,g=d("MLV2DataSourceLogger").getMLV2LoggerForThread(f,c);if(!e.$3){g==null?void 0:g.markQPLPoint("eb_extend_range_skipped_due_to_disabled");return(h||(h=b("Promise"))).resolve()}return e.$4(f).extendRange(a,c)};this.$2=d("ReQLObservable").create(a,function(){return d("ReQL").fromTableAscending(a.tables.secure_encrypted_backups_client_state).take(1).map(function(a){return a!=null&&a.backupTenancy!=null&&(k||(k=d("I64"))).equal(a.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE))})}).map(function(a){return Boolean(a==null?void 0:(a=a[0])==null?void 0:a[1])})["do"]({next:function(a){e.$3=a}})}var e=a.prototype;e.$4=function(a){var b=(k||(k=d("I64"))).to_string(a);if(!this.$1.has(b)){a=new m(a);this.$1.set(b,a)}return c("nullthrows")(this.$1.get(b))};return a}();function o(a){switch(a){case"asc":return"after";case"desc":return"before";case"point":return"point";default:return"point"}}var p,q;function a(a){(p==null||q!==a)&&(q=a,p=new n(a));return p}g["default"]=a}),98);
__d("MAWMessageRangeDataSource",["I64","LSDatabaseSingleton","MAWMiActOnActThreadReady","MAWPutMessagesToDB","MAWSecureLocalDBFetch","MLV2DataSourceLogger","MessageRangeSet","Promise","asyncToGeneratorRuntime","findMsgsWithMinAndMaxTimestamp","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=function(a){var e=this;this.$2=new(c("MessageRangeSet"))();this.getOrCreateMessageRangeCoveringCursor=function(a,b){b==null?void 0:b.annotateMessageRangesDataSource("MAWMessageRangeDataSource");b==null?void 0:b.markQPLPoint("maw_get_or_create_range_start");var c=e.$2.getRangeForTimestamp(a.timestampMs);if(c!=null){b==null?void 0:b.markQPLPoint("maw_preexisting_range");b==null?void 0:b.markQPLPoint("maw_get_or_create_range_end");return c}c=(j||(j=d("I64"))).equal(a.timestampMs,j.max_int);c={hasMoreAfter:!c,hasMoreBefore:!0,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:(c=a.messageId)!=null?c:"",maxTimestampMs:a.timestampMs,minMessageId:(c=a.messageId)!=null?c:"",minTimestampMs:a.timestampMs,threadKey:e.$1};a=e.$2.upsertRange(c);b==null?void 0:b.markQPLPoint("maw_range_created");b==null?void 0:b.markQPLPoint("maw_get_or_create_range_end");return a};this.extendRange=function(a,c){var f=d("MLV2DataSourceLogger").getMLV2LoggerForThread(e.$1,c);a=e.$2.getRangeForTimestamp(a.minTimestampMs);if(a==null){f==null?void 0:f.markQPLPoint("extend_range_canceled");return(h||(h=b("Promise"))).resolve()}var g=a.value;if(c==="asc"&&(!g.hasMoreAfter||g.isLoadingAfter)){f==null?void 0:f.markQPLPoint("extend_range_canceled");return(h||(h=b("Promise"))).resolve()}if(c==="desc"&&(!g.hasMoreBefore||g.isLoadingBefore)){f==null?void 0:f.markQPLPoint("extend_range_canceled");return(h||(h=b("Promise"))).resolve()}a.next(babelHelpers["extends"]({},g,{isLoadingAfter:g.isLoadingAfter||c==="asc",isLoadingBefore:g.isLoadingBefore||c==="desc"}));return e.$3(a.value,c)};this.$3=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b){var f=d("MLV2DataSourceLogger").getMLV2LoggerForThread(e.$1,b);f==null?void 0:f.markQPLPoint("maw_wait_act_thread_start");var g=(yield d("MAWMiActOnActThreadReady").waitForACTThreadReady((yield (i||(i=d("LSDatabaseSingleton"))).LSDatabaseSingleton).tables,e.$1,"MAWMessageRangeDataSourceForThread"));g=g.chatJid;f==null?void 0:f.markQPLPoint("maw_wait_act_thread_end");f==null?void 0:f.markQPLPoint("wait_secure_local_db_fetch_start");var h=(yield c("MAWSecureLocalDBFetch")({actionType:"user",chatJid:g,config:{editMsgHistory:!0,media:!0,reactions:!0,xma:!0},count:20,direction:l(b),offsetMsg:{includeOriginalMsg:!0,messageId:b==="asc"?a.maxMessageId:a.minMessageId},timestampMs:b==="asc"?a.maxTimestampMs:a.minTimestampMs}));f==null?void 0:f.markQPLPoint("insert_msgs_to_lsdb_start");yield d("MAWPutMessagesToDB").insertMessageResponseIntoDatabase(yield i.LSDatabaseSingleton,h);f==null?void 0:f.markQPLPoint("insert_msgs_to_lsdb_end");f==null?void 0:f.markQPLPoint("maw_upsert_range_start");g=c("findMsgsWithMinAndMaxTimestamp")(h.msgs);var k=g[0],m=g[1];g=babelHelpers["extends"]({},a,function(){var c;switch(b){case"asc":return{hasMoreAfter:h.hasMoreAfter,isLoadingAfter:!1,maxMessageId:(c=m==null?void 0:m.msgId)!=null?c:a.maxMessageId,maxTimestampMs:(j||(j=d("I64"))).max(a.maxTimestampMs,(m==null?void 0:m.sortOrderMs)!=null?(j||(j=d("I64"))).of_float(m==null?void 0:m.sortOrderMs):a.maxTimestampMs)};case"desc":return{hasMoreBefore:h.hasMoreBefore,isLoadingBefore:!1,minMessageId:(c=k==null?void 0:k.msgId)!=null?c:a.minMessageId,minTimestampMs:(j||(j=d("I64"))).min(a.minTimestampMs,(k==null?void 0:k.sortOrderMs)!=null?(j||(j=d("I64"))).of_float(k==null?void 0:k.sortOrderMs):a.minTimestampMs)}}}());e.$2.upsertRange(g);f==null?void 0:f.markQPLPoint("maw_upsert_range_end")});return function(b,c){return a.apply(this,arguments)}}();this.$1=a};a=function(){function a(){var a=this;this.$1=new Map();this.getOrCreateMessageRangeCoveringCursor=function(b,c){var d=b.threadKey;return a.$2(d).getOrCreateMessageRangeCoveringCursor(b,c)};this.extendRange=function(b,c){var d=b.threadKey;return a.$2(d).extendRange(b,c)}}var b=a.prototype;b.$2=function(a){var b=(j||(j=d("I64"))).to_string(a);if(!this.$1.has(b)){a=new k(a);this.$1.set(b,a)}return c("nullthrows")(this.$1.get(b))};return a}();function l(a){switch(a){case"asc":return"after";case"desc":return"before";case"point":return"point";default:return"point"}}e=new a();g["default"]=e}),98);
__d("combineLatestWith",["relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";function a(){for(var a=arguments.length,b=new Array(a),c=0;c<a;c++)b[c]=arguments[c];return d("relay-runtime").Observable.create(function(a){var c=new Set(b),d=new Set(b),e=b.map(function(){return void 0}),f=b.map(function(b,f){return b.subscribe({complete:function(){d["delete"](b),d.size===0&&a.complete()},error:a.error,next:function(d){e[f]=d,c["delete"](b),c.size===0&&a.next(e)}})});return function(){f.forEach(function(a){return a.unsubscribe()})}})}g["default"]=a}),98);
__d("MAWEBCombinedRangeDataSource",["EBMessageRangeDataSource","I64","MAWMessageRangeDataSource","Promise","asyncToGeneratorRuntime","combineLatestWith","err","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(a,b){if(a==null&&b==null)throw c("err")("Expected non-null minrange.");if(a==null||b==null){var e;e=c("nullthrows")((e=a)!=null?e:b);return{minMessageId:e.minMessageId,minTimestampMs:e.minTimestampMs}}e=(i||(i=d("I64"))).ge((e=a==null?void 0:a.minTimestampMs)!=null?e:(i||(i=d("I64"))).min_int,(e=b==null?void 0:b.minTimestampMs)!=null?e:(i||(i=d("I64"))).min_int)?a:b;return e.hasMoreBefore===!1?{minMessageId:(i||(i=d("I64"))).le(a.minTimestampMs,b.minTimestampMs)?a.minMessageId:b.minMessageId,minTimestampMs:(i||(i=d("I64"))).min(a.minTimestampMs,b.minTimestampMs)}:{minMessageId:e.minMessageId,minTimestampMs:e.minTimestampMs}}function k(a,b){if(a==null&&b==null)throw c("err")("Expected non-null maxrange.");if(a==null||b==null){var e;e=c("nullthrows")((e=a)!=null?e:b);return{maxMessageId:e.maxMessageId,maxTimestampMs:e.maxTimestampMs}}e=(i||(i=d("I64"))).le(a.maxTimestampMs,b.maxTimestampMs)?a:b;return e.hasMoreAfter===!1?{maxMessageId:(i||(i=d("I64"))).ge(a.maxTimestampMs,b.maxTimestampMs)?a.maxMessageId:b.maxMessageId,maxTimestampMs:(i||(i=d("I64"))).max(a.maxTimestampMs,b.maxTimestampMs)}:{maxMessageId:e.maxMessageId,maxTimestampMs:e.maxTimestampMs}}var l=function(a){var d=this;this.getOrCreateMessageRangeCoveringCursor=function(a,b){b==null?void 0:b.annotateMessageRangesDataSource("MAWEBCombinedRangeDataSource");var e=c("MAWMessageRangeDataSource").getOrCreateMessageRangeCoveringCursor(a,b);b=c("EBMessageRangeDataSource")(d.$1).getOrCreateMessageRangeCoveringCursor(a,b);return c("combineLatestWith")(e,b).map(function(b){var c=b[0];b=b[1];var d=k(c,b),e=j(c,b);return{hasMoreAfter:Boolean((c==null?void 0:c.hasMoreAfter)||(b==null?void 0:b.hasMoreAfter)),hasMoreBefore:Boolean((c==null?void 0:c.hasMoreBefore)||(b==null?void 0:b.hasMoreBefore)),isLoadingAfter:Boolean((c==null?void 0:c.isLoadingAfter)||(b==null?void 0:b.isLoadingAfter)),isLoadingBefore:Boolean((c==null?void 0:c.isLoadingBefore)||(b==null?void 0:b.isLoadingBefore)),maxMessageId:d.maxMessageId,maxTimestampMs:d.maxTimestampMs,minMessageId:e.minMessageId,minTimestampMs:e.minTimestampMs,threadKey:a.threadKey}})};this.extendRange=function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,e){yield (h||(h=b("Promise"))).all([c("EBMessageRangeDataSource")(d.$1).extendRange(a,e),c("MAWMessageRangeDataSource").extendRange(a,e)])});return function(b,c){return a.apply(this,arguments)}}();this.$1=a},m,n;function a(a){(m==null||n!==a)&&(n=a,m=new l(a));return m}g["default"]=a}),98);
__d("MAWMessageList.react",["BaseTheme.react","CometPageletWithDiv.react","CometScreenReaderText.react","LSMessagingThreadTypeUtil","MAWLoadingStateOutstandingUIReadyOfflineQueueSelector","MAWMessageListRow.react","MWBaseTheme","MWBlockingProtectionContext.react","MWContextBanner.react","MWInboxThreadMessagesSpinner.react","MWJumpToMostRecentMessageButton.react","MWPMessageListColumn.react","MWPMessageListFocusTable.react","MWPThreadCapabilitiesContext","MWPTypingIndicators.react","MWV2MessageRowSimple.react","cr:314","cr:3907","cr:8795","gkx","react","useMAWOfflineQueueLoadingIndicator","useMWEncryptedBackupsGetLatestMessageTimestampForThreadInEB","useMWMessageRowTheme","useMWPAriaLabelForMessageListGrid","useReStore","withCometPlaceholder"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react")),k=i,l=k.useId,m=k.useState;function n(a){return j.jsx(c("MWJumpToMostRecentMessageButton.react"),{onPress:a})}n.displayName=n.name+" [from "+f.id+"]";function a(a){var b=a.theme;b=b===void 0?d("MWBaseTheme").empty:b;var e=a.threadKey;a=a.threadType;var f=d("MWPTypingIndicators.react").useTypingParticipants(e),g=d("MWPTypingIndicators.react").useAccessibilityText(f);if(f.length>0)return j.jsx(c("BaseTheme.react"),{config:b,children:j.jsx(c("MWV2MessageRowSimple.react"),{children:j.jsxs(d("MWPMessageListColumn.react").MWPMessageListColumnGrow,{children:[j.jsx("div",{"aria-live":"polite",children:j.jsx(c("CometScreenReaderText.react"),{text:g})}),j.jsx(d("MWPTypingIndicators.react").MWPTypingIndicators,{threadKey:e,threadType:a})]})})});else return null}a.displayName=a.name+" [from "+f.id+"]";var o=d("withCometPlaceholder").withCometPlaceholder(a);k=j.forwardRef(e);function e(a,e){var f=a.cutoverOpenThread,g=a.entryPoint,i=a.onScrollToBottom,k=a.thread;a=(h||(h=c("useReStore")))();var p=c("useMWPAriaLabelForMessageListGrid")(k),q=c("useMWMessageRowTheme")(),r=m(""),s=r[0];r=r[1];var t=l(),u=c("useMWEncryptedBackupsGetLatestMessageTimestampForThreadInEB")(k.threadKey),v=b("cr:8795")(a,k.threadKey,k.threadType);a=c("useMAWOfflineQueueLoadingIndicator")(!1,k,d("MAWLoadingStateOutstandingUIReadyOfflineQueueSelector").outstandingUIReadyOfflineQueueSelector);var w=d("LSMessagingThreadTypeUtil").isArmadilloSecure(k.threadType);g=j.jsx(b("cr:314"),{entryPoint:g,onPageLoaded:function(a,b,c,d){w&&v(a,b,c,d)},onScrollToBottom:i,pageSize:c("gkx")("23432")?3:15,ref:e,renderFooter:function(){return j.jsx(o,{theme:q,threadKey:k.threadKey,threadType:k.threadType})},renderHeader:function(){return j.jsxs(d("MWPMessageListColumn.react").MWPMessageListColumnGrowJustified,{children:[j.jsx(d("MWPMessageListColumn.react").MWPMessageListColumnVerticalRhythm,{height:20}),j.jsx(c("MWContextBanner.react"),{threadKey:k.threadKey,threadType:k.threadType})]})},renderJumpToMostRecentMessageButton:n,renderLoadingAnimation:function(){return j.jsx(c("MWInboxThreadMessagesSpinner.react"),{})},renderRow:function(a){var b=a.domElementRef,d=a.message,e=a.nextMessage;a=a.prevMessage;return j.jsx(c("MAWMessageListRow.react"),{domElementRef:b,lastEbMessageTime:u,modal:s,row:{message:d,nextMessage:e,prevMessage:a},thread:k})},secondaryThread:f,shouldPausePageLoadTracking:a,thread:k});return j.jsx("div",{className:"x78zum5 xdt5ytf x1iyjqo2 x5yr21d","data-testid":void 0,id:t,children:j.jsx(d("CometPageletWithDiv.react").Placeholder,{className:"x78zum5 xdt5ytf x1iyjqo2 x5yr21d",fallback:null,name:"MWV2MessageList",children:j.jsx(d("MWPThreadCapabilitiesContext").Provider,{thread:k,children:j.jsx(c("MWBlockingProtectionContext.react").Provider,{children:j.jsx(c("MWPMessageListFocusTable.react"),{ariaLabel:p,modal:s,setModal:r,children:b("cr:3907")==null?g:j.jsx(b("cr:3907"),{id:t,children:g})})})})})})}e.displayName=e.name+" [from "+f.id+"]";a=k;g["default"]=a}),98);
__d("MAWSecureGroupedImageAttachment.react",["MAWAttachmentBlob.react","MAWGetAttachmentThumbnailBlob","MAWSecureImageAttachmentContent.react","react","useGetMediaGroupStyles"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||(h=d("react")),j=h.useEffect;function a(a){var b=a.mediaGroupInfo,e=a.mediaRenderQpl,f=a.outgoing;a=b.messagesAndAttachmentsShownInGroup;var g=b.tileSize;b=d("useGetMediaGroupStyles").useGetMediaGroupStyles(f,g);var h=b.containerStyles,k=b.coordinations,l=b.imageSize,m=b.wrapperStyles;j(function(){e==null?void 0:e.addPoint("render-grouped-image-attachment"),e==null?void 0:e.addAnnotations({bool:{is_grouped_image:!0}})},[e]);return i.jsx("div",{className:h,"data-testid":void 0,children:a.map(function(a,b){var h=a.attachment;a=a.message;return i.jsx("div",{className:m,style:babelHelpers["extends"]({zIndex:g-b},k[b]),children:i.jsx(c("MAWSecureImageAttachmentContent.react"),{connectBottom:!1,connectTop:!1,dbAttachment:h,getPlayableUrl:d("MAWAttachmentBlob.react").getAttachmentBlob,getPreviewUrl:c("MAWGetAttachmentThumbnailBlob"),mediaRenderQpl:e,message:a,outgoing:f,previewHeight:l,previewWidth:l,resizeToCover:!0})},b)})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWSecureThreadDetail.react",["CometPlaceholder.react","ComponentMountUnmountSubspanLogger.react","E2EEMessagingLinkContext.react","I64","LSAuthorityLevel","LSIntEnum","MAWMessageList.react","cr:8495","cr:9776","react","useReStore","useSecureThreadDetailGetDevices"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l,m=l||(l=d("react")),n=l.useState;function a(a,b){}var o=(h=b("cr:8495"))!=null?h:a;function e(a){var e=a.cutoverOpenThread,f=a.entryPoint,g=a.messageListRef;a=a.thread;var h=(i||(i=c("useReStore")))();c("useSecureThreadDetailGetDevices")(a,h);var l=n(!0),p=l[0],q=l[1];l=e!=null&&(j||(j=d("I64"))).equal(e.authorityLevel,(k||(k=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").AUTHORITATIVE));o(h,a.threadKey);return m.jsxs(m.Fragment,{children:[m.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MAWCutoverEncryptedBackupsBanner",children:b("cr:9776")!=null&&l&&m.jsx(b("cr:9776"),{isShown:!p})}),m.jsxs(d("E2EEMessagingLinkContext.react").E2EEMessagingLinkProvider,{isSecure:!0,children:[m.jsx(c("ComponentMountUnmountSubspanLogger.react"),{description:"MAWSecureThreadDetail"}),m.jsx(c("MAWMessageList.react"),{cutoverOpenThread:e,entryPoint:f,onScrollToBottom:function(a){return q(a)},ref:g,thread:a})]})]})}e.displayName=e.name+" [from "+f.id+"]";g["default"]=e}),98);
__d("MWPConcatenateMessageListsDataSource",["ReplayLastSubject","relay-runtime","switchMap"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(a){var b=a.count,e=a.first,f=a.getSecond;this.$1=c("switchMap")(e,function(a){var c=a.data.length;if(c>=b||a.hasMore||a.isLoadingMore)return new(d("ReplayLastSubject").ReplayLastSubject)(babelHelpers["extends"]({},a,{hasMore:!0}));c=d("relay-runtime").Observable.from(f(b-c));return c.map(function(b){return{data:[].concat(a.data,b.data),hasMore:a.hasMore||b.hasMore,isLoadingMore:a.isLoadingMore||b.isLoadingMore}})})}var b=a.prototype;b.subscribe=function(a){return this.$1.subscribe(a)};return a}();g["default"]=a}),98);
__d("memoizeObservable",["deepEquals","relay-runtime"],(function(a,b,c,d,e,f,g){"use strict";var h={};function a(a,b){b===void 0&&(b=c("deepEquals"));return d("relay-runtime").Observable.create(function(c){var d=h,e=a.subscribe({complete:function(){c.complete()},error:function(a){c.error(a)},next:function(a){b(d,a)||(d=a,c.next(a))}});return function(){e.unsubscribe()}})}g["default"]=a}),98);
__d("MWPMessageListSingleDirectionDataSource",["I64","MLV2DataSourceLogger","ReQL","ReQLObservable","ReplayLastSubject","combineLatestWith","memoizeObservable","promiseDone","relay-runtime","switchMap"],(function(a,b,c,d,e,f,g){"use strict";var h;function i(a){return a.length>0?a[a.length-1]:void 0}var j=2;a=function(){function a(a,b,c,e,f,g){this.$6=new(d("ReplayLastSubject").ReplayLastSubject)(!1),this.$1=a,this.$3=b,this.$2=c,this.$4=e,this.$5=f,this.$8=d("MLV2DataSourceLogger").startMLV2LoggerForThread(this.$3.threadKey,this.$2,this.$4,g),this.$7=this.$9()}var b=a.prototype;b.subscribe=function(a){var b;(b=this.$8)==null?void 0:b.markQPLPoint("subscribed");return this.$7.subscribe(a)};b.$10=function(a){var b,d=this;this.$6.next(!0);(b=this.$8)==null?void 0:b.markQPLPoint("fetch_more_msgs_start");c("promiseDone")(this.$5.extendRange(a,this.$2)["finally"](function(){var a;(a=d.$8)==null?void 0:a.markQPLPoint("fetch_more_msgs_end","begin attempting to extend a message range in a given direction");return d.$6.next(!1)}))};b.$11=function(a){var b=this.$3,c=b.messageId;b=b.timestampMs;c=(c==null||c==="")&&(h||(h=d("I64"))).equal(b,(h||(h=d("I64"))).max_int);b=c&&(h||(h=d("I64"))).equal(a.minTimestampMs,(h||(h=d("I64"))).max_int);c=!a.hasMoreBefore||b;c=this.$2==="asc"?{gte:d("ReQL").key(this.$3.timestampMs),lte:d("ReQL").key(a.hasMoreAfter?a.maxTimestampMs:(h||(h=d("I64"))).max_int)}:{gte:d("ReQL").key(c?(h||(h=d("I64"))).min_int:a.minTimestampMs),lte:d("ReQL").key(this.$3.timestampMs)};var e=(this.$2==="asc"?d("ReQL").fromTableAscending:d("ReQL").fromTableDescending)(this.$1.tables.messages).getKeyRange(this.$3.threadKey).bounds(c).take(b?j:this.$4);return d("ReQLObservable").create(this.$1,function(){return e})};b.$12=function(a,b,c){var d,e;b===void 0&&(b=[]);a=a;d=(d=i(b))==null?void 0:d[1];e=this.$2==="asc"?[c==null?void 0:c.maxMessageId,(e=c==null?void 0:c.hasMoreAfter)!=null?e:!1,(e=c==null?void 0:c.isLoadingAfter)!=null?e:!1]:[c==null?void 0:c.minMessageId,(e=c==null?void 0:c.hasMoreBefore)!=null?e:!1,(e=c==null?void 0:c.isLoadingBefore)!=null?e:!1];var f=e[0],g=e[1];e=e[2];d=b.length===this.$4&&(d!=null&&d.messageId!==f||!g);c!=null&&b.length<this.$4&&g&&!d&&!a&&!e&&(a=!0,this.$10(c));return{data:b,hasMore:d||g,isLoadingMore:a||!d&&e}};b.$9=function(){var a=this;return(h||(h=d("I64"))).equal(this.$3.timestampMs,(h||(h=d("I64"))).max_int)&&this.$2==="asc"?d("relay-runtime").Observable.from(new(d("ReplayLastSubject").ReplayLastSubject)({data:[],hasMore:!1,isLoadingMore:!1})):c("memoizeObservable")(c("combineLatestWith")(this.$6,c("switchMap")(this.$5.getOrCreateMessageRangeCoveringCursor(this.$3,this.$8),function(b){var c;(c=a.$8)==null?void 0:c.markQPLPoint("emitting_range");return a.$11(b).map(function(a){return{messages:a,messagesRange:b}})})).map(function(b){var c=b[0];b=b[1];b=(b=b)!=null?b:{};var d=b.messages;b=b.messagesRange;return a.$12(c,d,b)}))["do"]({error:function(b){var c;(c=a.$8)==null?void 0:c.markQPLFailure(b);a.$8=void 0},next:function(b){var c,d=b.data;b=b.isLoadingMore;(c=a.$8)==null?void 0:c.markQPLPoint("emitting_messages");if(!b){(c=a.$8)==null?void 0:c.addQPLAnnotations({"int":{final_query_count:a.$4,num_fetched:d.length}});(b=a.$8)==null?void 0:b.markQPLSuccess();a.$8=void 0}else{(c=a.$8)==null?void 0:c.markQPLPoint("waiting_for_fetch")}}})};return a}();g["default"]=a}),98);
__d("MWPMessageRangeDataSource",["I64","LSFactory","LSIntEnum","LSIssueMessagesRangeQueryStoredProcedure","LSMailboxMessagesRangeQueryDirection","LSMessagePointQueryStoredProcedure","MLV2DataSourceLogger","Promise","ReQL","ReQLObservable","asyncToGeneratorRuntime","err","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;a=function(a){var e=this;this.$2=function(a){return k(e.$1.tables.messages_ranges_v2__generated,a)};this.getOrCreateMessageRangeCoveringCursor=function(a,b){b==null?void 0:b.annotateMessageRangesDataSource("MWPMessageRangeDataSource");b==null?void 0:b.markQPLPoint("msys_message_range_fetch_start");return d("ReQLObservable").create(e.$1,function(){return e.$2(a)}).map(function(f){b==null?void 0:b.markQPLPoint("msys_message_range_fetch_end");f=(f=f[0])==null?void 0:f[1];if(f==null)if(a.messageId==null){var g;return{hasMoreAfter:!(j||(j=d("I64"))).equal(a.timestampMs,j.max_int),hasMoreBefore:!0,isLoadingAfter:!1,isLoadingBefore:!1,maxMessageId:(g=a.messageId)!=null?g:"",maxTimestampMs:a.timestampMs,minMessageId:(g=a.messageId)!=null?g:"",minTimestampMs:a.timestampMs,threadKey:a.threadKey}}else{c("promiseDone")(p(e.$1,a));return{hasMoreAfter:!0,hasMoreBefore:!0,isLoadingAfter:!0,isLoadingBefore:!0,maxMessageId:(g=a.messageId)!=null?g:"",maxTimestampMs:a.timestampMs,minMessageId:(g=a.messageId)!=null?g:"",minTimestampMs:a.timestampMs,threadKey:a.threadKey}}return f})};this.extendRange=function(a,g){var i=d("MLV2DataSourceLogger").getMLV2LoggerForThread(a.threadKey,g),k=a.threadKey;if(!n(a,g)){i==null?void 0:i.markQPLPoint("mwp_msg_range_not_extensible","Trying to extend a range that is not extensible");return(h||(h=b("Promise"))).resolve()}return e.$1.runInTransaction(function(){var e=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b){var e;i==null?void 0:i.markQPLPoint("fetch_message_ranges_from_table_start","Find a range in the database matching the range we were handed.");e=(e=(yield d("ReQL").firstAsync(d("ReQL").fromTableDescending(b.messages_ranges_v2__generated).getKeyRange(k).bounds({lte:d("ReQL").key(a.minTimestampMs)}).filter(function(b){return(j||(j=d("I64"))).ge(b.maxTimestampMs,a.maxTimestampMs)}))))!=null?e:a;if(!n(e,g)){i==null?void 0:i.markQPLPoint("mwp_msg_range_not_extensible","Trying to extend a range that is not extensible");return}if(!l(e,a,g)){i==null?void 0:i.markQPLPoint("mwp_msg_range_bound_mismatch","The range we are trying to extend has already been extended");return}i==null?void 0:i.markQPLPoint("mwp_fetch_message_ranges_start","Begin fetching message ranges");return c("LSIssueMessagesRangeQueryStoredProcedure")(c("LSFactory")(b),m(e,g))["finally"](function(){i==null?void 0:i.markQPLPoint("mwp_fetch_message_ranges_end","Finish fetching message ranges")})});return function(a){return e.apply(this,arguments)}}(),"readwrite",void 0,void 0,f.id+":128")};this.$1=a};function k(a,b){return d("ReQL").fromTableDescending(a).getKeyRange(b.threadKey).bounds({lte:d("ReQL").key(b.timestampMs)}).filter(function(a){return o(b,a)}).take(1)}function l(a,b,c){if(c==="asc")return(j||(j=d("I64"))).equal(a.minTimestampMs,b.minTimestampMs);else return(j||(j=d("I64"))).equal(a.maxTimestampMs,b.maxTimestampMs)}function m(a,b){var e=a.maxTimestampMs,f=a.minTimestampMs;a=a.threadKey;return b==="asc"?{direction:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMailboxMessagesRangeQueryDirection").AFTER),referenceTimestampMs:e,threadKey:a}:{direction:(i||(i=d("LSIntEnum"))).ofNumber(c("LSMailboxMessagesRangeQueryDirection").BEFORE),referenceTimestampMs:f,threadKey:a}}function n(a,b){return b==="asc"&&a.hasMoreAfter&&!a.isLoadingAfter||b==="desc"&&a.hasMoreBefore&&!a.isLoadingBefore}function o(a,b){a=a.timestampMs;return((j||(j=d("I64"))).equal(a,(j||(j=d("I64"))).max_int)||(j||(j=d("I64"))).ge(b.maxTimestampMs,a))&&(j||(j=d("I64"))).le(b.minTimestampMs,a)}function p(a,b,c){return q.apply(this,arguments)}function q(){q=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a,b,e){e===void 0&&(e=20);var g=b.messageId,h=b.threadKey;if(g==null)throw c("err")("Cannot issue a point query without a message ID.");yield a.runInTransaction(function(a){return c("LSMessagePointQueryStoredProcedure")(c("LSFactory")(a),{messageId:g,numContextMessages:(j||(j=d("I64"))).of_float(e),threadKey:h})},"readwrite",void 0,void 0,f.id+":282")});return q.apply(this,arguments)}g.MSYSMessageRangeDataSource=a}),98);
__d("MWPMessageListDataSource",["I64","LSMessagingThreadTypeUtil","MAWEBCombinedRangeDataSource","MWPConcatenateMessageListsDataSource","MWPMessageListSingleDirectionDataSource","MWPMessageRangeDataSource","combineLatestWith","nullthrows"],(function(a,b,c,d,e,f,g){"use strict";var h;a=function(){var a=b.prototype;a.subscribe=function(a){return this.$1.subscribe(a)};function b(a,b){var e=b.after,f=b.before,g=b.cursor,k=b.secondaryThreadKey,l=b.secondaryThreadType,m=b.threadType,n=function(b,e){return new(c("MWPMessageListSingleDirectionDataSource"))(a,e==="desc"&&!(h||(h=d("I64"))).equal(g.timestampMs,(h||(h=d("I64"))).max_int)?babelHelpers["extends"]({},g,{timestampMs:(h||(h=d("I64"))).sub(g.timestampMs,(h||(h=d("I64"))).one)}):g,e,b,i(a,m),m)},o=function(b,e){return new(c("MWPMessageListSingleDirectionDataSource"))(a,{messageId:g.messageId,threadKey:c("nullthrows")(k),timestampMs:e==="desc"&&!(h||(h=d("I64"))).equal(g.timestampMs,(h||(h=d("I64"))).max_int)?(h||(h=d("I64"))).sub(g.timestampMs,(h||(h=d("I64"))).one):g.timestampMs},e,b,i(a,c("nullthrows")(l)),m)},p;k==null||l==null?(b=n(f,"desc"),p=n(e,"asc")):(b=new(c("MWPConcatenateMessageListsDataSource"))({count:f,first:n(f,"desc"),getSecond:function(a){return o(a,"desc")}}),p=new(c("MWPConcatenateMessageListsDataSource"))({count:e,first:o(e,"asc"),getSecond:function(a){return n(a,"asc")}}));this.$1=c("combineLatestWith")(b,p).map(function(a){var b=a[0];a=a[1];var c=b.data.toReversed().concat(a.data).sort(j(g.threadKey));return{data:c,hasNext:a.hasMore,hasPrevious:b.hasMore,isLoadingNext:a.isLoadingMore,isLoadingPrevious:b.isLoadingMore}})}return b}();function i(a,b){return d("LSMessagingThreadTypeUtil").isArmadilloSecure(b)?c("MAWEBCombinedRangeDataSource")(a):new(d("MWPMessageRangeDataSource").MSYSMessageRangeDataSource)(a)}var j=function(a){return function(b,c){b=b[1];c=c[1];var e=(h||(h=d("I64"))).compare(b.threadKey,c.threadKey);if(e!==0)return(h||(h=d("I64"))).equal(b.threadKey,a)?1:-1;e=h.compare(b.primarySortKey,c.primarySortKey);if(e!==0)return e;e=h.compare((e=b.secondarySortKey)!=null?e:(h||(h=d("I64"))).zero,(e=c.secondarySortKey)!=null?e:(h||(h=d("I64"))).zero);return e!==0?e:h.compare(b.timestampMs,c.timestampMs)}};g["default"]=a}),98);
__d("useIsNearBottomOfScrollArea",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useLayoutEffect,j=b.useState,k=10;function a(a,b){b===void 0&&(b=k);var c=j(!0),d=c[0],e=c[1];i(function(){var c=a.current;if(c==null)return;var d=function(){return e(Math.abs(c.scrollHeight-c.scrollTop-c.clientHeight)<b)},f=window.requestAnimationFrame(d);c.addEventListener("scroll",d);return function(){c.removeEventListener("scroll",d),window.cancelAnimationFrame(f)}},[b,a]);return d}g["default"]=a}),98);
__d("MWPMessageListJumpToMostRecentMessageButton.react",["MWPJumpToMostRecentMessageButtonAnimationWrapper.react","react","useIsNearBottomOfScrollArea"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||c("react");function a(a){var b=a.alwaysShow,d=a.jumpToMostRecentMessage,e=a.renderButton;a=a.scrollAreaRef;a=c("useIsNearBottomOfScrollArea")(a,108);a=a===!1||b;return e?i.jsx(c("MWPJumpToMostRecentMessageButtonAnimationWrapper.react"),{visible:a,children:e(d)}):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWXMessageScrollList.react",["CometInfiniteScrollTrigger.react","MWXScrollableAreaStyles","react","stylex","useMergeRefs","useResizeObserver"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=i||(i=d("react"));b=i;var k=b.useCallback,l=b.useLayoutEffect,m=b.useRef,n=10,o=function(a){return a},p={expanding:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"x2lah0s",justifyContent:"xl56j7k",minHeight:"x121v3j4",$$css:!0},scrollArea:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",overflowX:"x6ikm8r",overflowY:"x1odjw0f",$$css:!0}};function q(a){var b=a.anchoredElement,d=a.getKeyForItem;d=d===void 0?o:d;var e=a.hasNext;a=a.items;var f=a.length,g=f>0?d(a[0]):void 0,h=f>0?d(a[a.length-1]):void 0,i=m(f),j=m(g),p=m(h),q=m(),r=m(),s=m(),t=m(),u=m();d=k(function(a){a=a.target;if(!(a instanceof HTMLDivElement))return;s.current=a.scrollTop},[]);l(function(){var a=u.current;if(a==null)return;a.scrollTop<=n&&(a.scrollTop=a.scrollHeight)},[]);a=k(function(){var a,c,d,k,l,m,o;a=(a=b==null?void 0:(a=b.current)==null?void 0:a.offsetTop)!=null?a:0;var v=p.current,w=j.current;c=(c=i.current)!=null?c:0;d=(d=q.current)!=null?d:0;k=(k=r.current)!=null?k:0;l=(l=s.current)!=null?l:0;m=(m=t.current)!=null?m:-1;var x=u.current;q.current=(o=x==null?void 0:x.scrollHeight)!=null?o:q.current;s.current=(o=x==null?void 0:x.scrollTop)!=null?o:s.current;i.current=f;j.current=g;p.current=h;t.current=a;if(x==null)return;o=x.clientHeight;var y=x.scrollHeight;r.current=o;var z=Math.abs(d-l-k)<n;v=v!=null&&h!==v;w=w!=null&&g!==w;c=f>c;w=c&&w;c=c&&v;var A=k!==0&&k!==o;v=m!==-1&&m>l&&m<l+k;var B;(b==null?void 0:b.current)!=null&&v?B=a-(m-l):!e&&z?B=l+y-d+k-o:w?B=l+y-d:c&&(B=l);var C=B;if(C!=null){x.scrollTop=C;s.current=B;var D=window.requestAnimationFrame(function(){var a=x.scrollTop;Math.abs(a-C)>n?x.scrollTop=C+(a>C?1:-1)*n:A&&(x.scrollTop=C)});return function(){return window.cancelAnimationFrame(D)}}},[g,e,h,f,b]);var v=c("useResizeObserver")(a),w=c("useResizeObserver")(a);l(a,[a]);return{contentRef:w,onScroll:d,ref:c("useMergeRefs")(u,v)}}e=j.forwardRef(a);function a(a,b){var d=a.anchoredElement,e=a.ariaLabel,f=a.getKeyForItem,g=a.hasNext,i=a.hasPrevious,l=a.isLoadingNext,m=a.isLoadingPrevious,n=a.items,o=a.loadNext,r=a.loadPrevious,s=a.onUserScroll,t=a.renderFooter,u=a.renderHeader,v=a.renderItem;a=a.renderLoadingAnimation;u=[!i&&u!=null&&j.jsx(j.Fragment,{children:u()},"header"),j.jsx(c("CometInfiniteScrollTrigger.react"),{hasMore:i,isLoading:m,onLoadMore:r,xstyle:p.expanding,children:a==null?void 0:a()},"loadPrevious")].concat(n.map(function(a,b){return v(a,n[b-1],n[b+1])}),[j.jsx(c("CometInfiniteScrollTrigger.react"),{hasMore:g,isLoading:l,onLoadMore:o,xstyle:p.expanding,children:a==null?void 0:a()},"loadNext"),!g&&t!=null&&j.jsx(j.Fragment,{children:t()},"footer")]);i=q({anchoredElement:d,getKeyForItem:f,hasNext:g,items:n});m=i.contentRef;var w=i.onScroll;r=i.ref;l=k(function(a){s==null?void 0:s(),w(a)},[s,w]);o=c("useMergeRefs")(r,b);return j.jsx("div",{"aria-label":e,className:(h||(h=c("stylex")))(p.scrollArea,c("MWXScrollableAreaStyles").themed),onScroll:l,ref:o,role:"grid",children:j.jsx("div",{className:"x78zum5 xdt5ytf x1iyjqo2 x2lah0s xl56j7k x121v3j4",ref:m,children:u})})}a.displayName=a.name+" [from "+f.id+"]";d=e;g["default"]=d}),98);
__d("useMWPMessageListOnScrollToBottom",["Promise","react","useIsNearBottomOfScrollArea","useMWPSafelyMarkThreadAsRead"],(function(a,b,c,d,e,f,g){"use strict";var h,i;e=i||d("react");var j=e.useCallback,k=e.useEffect;function l(a,d,e,f,g){var i=j(function(){return(h||(h=b("Promise"))).resolve(f&&!e)},[e,f]),l=c("useMWPSafelyMarkThreadAsRead")(g,i,a,d),m=a();k(function(){f&&!m&&l()},[f,m,l])}function a(a,b,d,e,f,g){var h=c("useIsNearBottomOfScrollArea")(f);k(function(){e!=null&&e(h)},[h,e]);l(a,b,d,h,g)}g["default"]=a}),98);
__d("getOrCreateMapValue",[],(function(a,b,c,d,e,f){"use strict";function a(a,b,c){var d=a.get(b);d==null&&(d=c(),a.set(b,d));return d}f["default"]=a}),66);
__d("useMWPMessageListScrollVisibleMessageIntoView",["MWPVisibleMessageContext.react","getOrCreateMapValue","react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.createRef,j=b.startTransition,k=b.useCallback,l=b.useEffect,m=b.useRef;function a(){var a=m(new Map()),b=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext(),e=b.setVisibleMessage,f=b.visibleMessage;b=k(function(b){var d=c("getOrCreateMapValue")(a.current,b,i);f!=null&&b===f.messageId&&(f==null?void 0:f.ref)!==d&&e(babelHelpers["extends"]({},f,{ref:d}));return d},[e,f]);l(function(){var b=f==null?void 0:f.messageId;if(b==null||f==null)return;var c=a.current.get(b);c!==(f==null?void 0:f.ref)&&j(function(){e(babelHelpers["extends"]({},f,{ref:c}))})},[f,e]);l(function(){var a,b=f==null?void 0:(a=f.ref)==null?void 0:a.current;if(b==null)return;var c=window.requestAnimationFrame(function(){b.scrollIntoView({behavior:"instant",block:"start",inline:"nearest"})});return function(){return window.cancelAnimationFrame(c)}},[f]);return b}g["default"]=a}),98);
__d("useMWPRelayMessageListJumpToMostRecentMessage",["MWPVisibleMessageContext.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h;h||(h=d("react"));var i=h.useCallback;function a(a){var b=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext(),c=b.setVisibleMessage;return i(function(){var b=a.current;b!=null&&(c(void 0),b.scrollTop=b.scrollHeight)},[a,c])}g["default"]=a}),98);
__d("MWPRelayBaseMessageList.react",["BaseHeadingContextWrapper.react","Box.react","CometHeroHoldTrigger.react","CometHideableComponentExperiment.react","I64","LSAuthorityLevel","LSIntEnum","LSMessagingThreadTypeUtil","MWPMessageAuthor.react","MWPMessageListJumpToMostRecentMessageButton.react","MWPVisibleMessageContext.react","MWXMessageScrollList.react","MessageForIntegrityCheck","cr:6271","emptyFunction","react","useMWPMessageListOnScrollToBottom","useMWPMessageListScrollVisibleMessageIntoView","useMWPRelayMessageListJumpToMostRecentMessage","useObserveMessagePageLoad"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k=h||(h=d("react")),l=h,m=l.useImperativeHandle,n=l.useRef,o={backgroundColor:{backgroundColor:"x1eb86dx",$$css:!0},list:{display:"x78zum5",flexDirection:"xdt5ytf",flexGrow:"x1iyjqo2",flexShrink:"xs83m0k",overflowX:"x6ikm8r",overflowY:"x10wlt62",zIndex:"x1ja2u2z",$$css:!0}},p=k.forwardRef(a);function a(a,e){var f=a.checkIsThreadManuallySetAsUnread;f=f===void 0?c("emptyFunction").thatReturnsFalse:f;var g=a.entryPoint,h=a.onPageLoaded;h=h===void 0?c("emptyFunction"):h;var i=a.onScrollToBottom,j=a.onUserScroll,l=a.renderFooter,p=a.renderHeader,q=a.renderJumpToMostRecentMessageButton,r=a.renderLoadingAnimation,s=a.renderRow,t=a.secondaryThread,u=a.shouldPausePageLoadTracking;u=u===void 0?!1:u;a=a.thread;var v=n();t=b("cr:6271")(a,t);var w=t.hasNext,x=t.hasPrevious,y=t.isLoadingNext,z=t.isLoadingPrevious,A=t.loadNext,B=t.loadPrevious;t=t.messages;var C=c("useMWPMessageListScrollVisibleMessageIntoView")();d("useObserveMessagePageLoad").useObserveMessagePageLoadWithAggregation(t.map(function(a){return d("MessageForIntegrityCheck").prepMessageForIntegrityCheck(a)}),10,h,u,w);c("useMWPMessageListOnScrollToBottom")(f,g,w,i,v,a);var D=c("useMWPRelayMessageListJumpToMostRecentMessage")(v);m(e,function(){return{getScrollAreaElement:c("emptyFunction"),jumpToMostRecentMessage:function(){D(!0)},restoreScrollPosition:c("emptyFunction")}},[D]);var E=n(null);return k.jsxs(c("Box.react"),{xstyle:o.list,children:[k.jsx(c("BaseHeadingContextWrapper.react"),{children:k.jsx(c("MWXMessageScrollList.react"),{anchoredElement:(h=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext().visibleMessage)==null?void 0:h.ref,getKeyForItem:function(a){return a.messageId},hasNext:w,hasPrevious:x,isLoadingNext:y,isLoadingPrevious:z,items:t,loadNext:A,loadPrevious:B,onUserScroll:j,ref:v,renderFooter:l,renderHeader:p,renderItem:function(a,b,e){return k.jsx("div",{ref:C(a.messageId),children:k.jsx(c("CometHideableComponentExperiment.react"),{callingSurface:"thread_view",disableHiding:!0,scrollport:function(){return v.current},unmountXStyle:o.backgroundColor,children:k.jsx(d("MWPMessageAuthor.react").MWPMessageAuthor,{contactId:a.senderId,threadKey:a.threadKey,children:s({domElementRef:E,message:a,nextMessage:e,prevMessage:b})})})},a.offlineThreadingId)},renderLoadingAnimation:r})}),k.jsx(c("MWPMessageListJumpToMostRecentMessageButton.react"),{alwaysShow:w,jumpToMostRecentMessage:D,renderButton:q,scrollAreaRef:v})]})}a.displayName=a.name+" [from "+f.id+"]";l=k.forwardRef(e);function e(a,b){a.pageSize;a=babelHelpers.objectWithoutPropertiesLoose(a,["pageSize"]);var e=a.renderHeader,f=a.renderLoadingAnimation,g=a.thread;if((i||(i=d("I64"))).equal(g.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC)))return k.jsxs(k.Fragment,{children:[k.jsx(c("CometHeroHoldTrigger.react"),{description:"MWChatWaitingForDisplayState-optimisticThread",hold:!0}),e==null?void 0:e()]});e=(i||(i=d("I64"))).equal(g.authorityLevel,(j||(j=d("LSIntEnum"))).ofNumber(c("LSAuthorityLevel").OPTIMISTIC))&&d("LSMessagingThreadTypeUtil").isCMSubthread(g.threadType);return e?k.jsxs(k.Fragment,{children:[k.jsx(c("CometHeroHoldTrigger.react"),{description:"MWChatWaitingForDisplayState-optimisticSubThread",hold:!0}),f==null?void 0:f()]}):k.jsx(p,babelHelpers["extends"]({},a,{ref:b}))}e.displayName=e.name+" [from "+f.id+"]";a=l;g["default"]=a}),98);
__d("useObservable",["react"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useEffect,j=b.useState;function a(a){var b=j(),c=b[0],d=b[1];b=j();var e=b[0],f=b[1];b=j(!1);var g=b[0],h=b[1];i(function(){var b=a.subscribe({complete:function(){return h(!0)},error:f,next:d});return function(){return b.unsubscribe()}},[a]);return[c,e,g]}g["default"]=a}),98);
__d("useMWPMessageListData",["I64","Int64Hooks","MWPMessageListDataSource","MWPVisibleMessageContext.react","react","useObservable","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;b=j||d("react");var k=b.useCallback,l=b.useMemo,m=b.useState,n=15;function a(a,b){var e,f=a.threadKey,g=a.threadType,j=(h||(h=c("useReStore")))();a=d("MWPVisibleMessageContext.react").useMWPVisibleMessageContext();a=a.visibleMessage;var o=a==null?void 0:a.messageId,p=(a=a==null?void 0:a.timestamp)!=null?a:(i||(i=d("I64"))).max_int,q=b==null?void 0:b.threadKey,r=b==null?void 0:b.threadType;a=m(n);var s=a[0],t=a[1];b=m(n);var u=b[0],v=b[1];a=m(o);var w=a[0],x=a[1];b=m(p);var y=b[0],z=b[1];a=d("Int64Hooks").useMemoInt64(function(){return new(c("MWPMessageListDataSource"))(j,{after:u,before:s,cursor:{messageId:w,threadKey:f,timestampMs:y},secondaryThreadKey:q,secondaryThreadType:r,threadType:g})},[u,s,j,w,q,r,f,g,y]);b=c("useObservable")(a);var A=b[0];a=b[1];if(a!=null)throw a;b=l(function(){var a;return(a=A==null?void 0:A.data.map(function(a){a[0];a=a[1];return a}))!=null?a:[]},[A]);var B=b.some(function(a){return a.messageId===o});d("Int64Hooks").useEffectInt64(function(){B||(z(p),x(o),t(n),v(n))},[B,o,p]);var C=(a=A==null?void 0:A.hasNext)!=null?a:!1,D=(a=A==null?void 0:A.isLoadingNext)!=null?a:!1;a=k(function(){!D&&C&&v(u+n)},[C,D,u]);var E=(e=A==null?void 0:A.hasPrevious)!=null?e:!1,F=(e=A==null?void 0:A.isLoadingPrevious)!=null?e:!1;e=k(function(){!F&&E&&t(s+n)},[E,F,s]);return{hasNext:C,hasPrevious:E,isLoadingNext:D,isLoadingPrevious:F,loadNext:a,loadPrevious:e,messages:b}}g["default"]=a}),98);